<!DOCTYPE html>
<html lang="en">
<head>
<!-- basic -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- mobile metas -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="viewport" content="initial-scale=1, maximum-scale=1">
<!-- site metas -->
<title>Long term stock fundamentals</title>
<meta name="keywords" content="stock, fundamentals, long-term, long term, trends, risk, analysis, research">
<meta name="description" content="Long term stock fundamentals">
<!-- style css -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<!-- Responsive-->
<link rel="stylesheet" href="/css/responsive.css">
<!-- Scrollbar Custom CSS -->
<link rel="stylesheet" href="/css/jquery.mCustomScrollbar.min.css">
<!-- Tweaks for older IEs-->
<link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" href="/css/autocomplete/autocomplete.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cookie">


<script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/autoComplete.min.js"></script>

<link rel="stylesheet" type="text/css" href="/css/style.css">
<link rel="stylesheet" type="text/css" href="/css/common-style.css">
</head>
<body>
	<header id="home" class="section">
	<div class="header_main">
         <!-- header inner -->
         <div class="header">
            <div class="container">
               <div class="row">
                  <div class="col-lg-5 col logo_section">
                     <div class="full">
                        <div class="center-desk">
                           <a href="/">
                             <div class="logo">
                                <h1 style="float:left;color:white; margin-right: 10px;margin-top:8px;"><i class="fa-solid fa-chart-simple"></i></h1>
                                <h1 style="color:white;font-family:Cookie;line-height: 0.8;letter-spacing: -2px;">LongTermStock<br/>Fundamentals</h1>
                             </div>
                           </a>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <!-- end header inner -->
      <section >
      	<div class="bannen_inner">
            <div class="container profile-container">
                <div class="row marginii">
                    <div class="">
                        <h1 class=""><strong>Profile</strong></h1>
                        
                        <div class="faq-card">
                          <div class="row profile-row">
                            <div class="col-md-4">
                              Email
                            </div>
                            <div class="col-md-3" th:text="${loginEmail}">
                            </div>
                          </div>
                          <div class="row profile-row">
                            <div class="col-md-4">
                              Stocks viewed
                            </div>
                            <div class="col-md-3" th:text="${currentlyViewText} + ' / ' + ${viewLimitText}">
                              Email
                            </div>
                          </div>
                          <div class="row profile-row" th:unless="${accountType == 'FREE'}">
                            <div class="col-md-4">
                              Load Stripe customer portal
                            </div>
                            <div class="col-md-3">
                              <form action="/payment/customerportal" method="POST">
                                <input type="submit" class="btn btn-md btn-success" value="Stripe customer portal"></input>
                              </form>
                            </div>
                            <div class="col-md-5 profile-explanation">
                              Use customer portal to change payment method, and check your invoices.
                            </div>
                          </div>
                          <div class="row profile-row">
                            <div class="col-md-4">
                              Refresh authentication
                            </div>
                            <div class="col-md-3" >
                              <button class="btn btn-md btn-dark" onclick="refreshJwt()">Refresh</button>
                            </div>
                            <div class="col-md-5 profile-explanation">
                              Use when some information did not refresh.
                            </div>
                          </div>
                          <div class="row profile-row" th:unless="${accountType == 'FREE'}">
                            <div class="col-md-4">
                              Delete account
                            </div>
                            <div class="col-md-3">
                              <button class="btn btn-md btn-danger" onclick="deleteAccount()">Delete account</button>
                            </div>
                            <div class="col-md-5 profile-explanation">
                              Danger, this cannot be undone!
                            </div>
                          </div>
                        </div>
                    </div>
            </div>
           </div>

     </div>
    </div>
    </section>
	</header>
  <div id="generic-modal" class="modal fade" role="dialog">
      <div class="modal-dialog">
          <div class="modal-content">
          </div>
      </div>
  </div>
  <span id="login-account-type" th:text="${loginAccountType}" style="display:none"></span>
	<script>
	  function refreshJwt() {
      fetch('/user/jwt/refresh?force=true', {
            method: 'POST',
            headers: {
              'Accept': 'application/json',
              'Content-Type': 'application/json'
            }
          }).then(() => {
            location.reload();
          });
      }
      
    
    function deleteAccount() {
        accountType = $("#login-account-type").text();
        
        additionalText = "";
        
        if (accountType != "FREE") {
          additionalText += "<br/><b>Removing account will cancel your current subscription.<br/>If you would like to cancel your subscription you can do that without deleting your account by clicking \"Downgrade\" on the plans panel under the free plan.</b>";
        }
        
        $("#generic-modal .modal-content")
        $("#generic-modal .modal-content").html(`
            <div class="modal-header">
                <h5 class="modal-title">Delete account</h5>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modal-body">
                We are sad to see you go!<br/>
                Once you click delete, this action cannot be undone.<br>
                ` + additionalText + `<br/><br/>
                For additional security, please provide your password:
                <input class="form-control" id="delete-account-password" type="password"></input>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-dismiss="modal">Cancel</button>
                <button id="delete-account-button" type="button" class="btn btn-danger">Delete</button>
            </div>`);
        $("#generic-modal").modal("show");
    
        $("#delete-account-button").click(function() {
              password = $("#delete-account-password").val();
              fetch('/user/delete', {
                      method: 'POST',
                      headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                      },
                      body: JSON.stringify({password: password})
                  })
                  .then(async function(res) {
                      json = await res.json();
                      redirectTo="";
                      if (res.status == 200) {
                        result = "Account succesfully removed";
                        redirectTo = "/";
                      } else {
                        result = json.errorMessage;
                        redirectTo = "/profile";
                      }
                      
                      $("#generic-modal .modal-content").html(`
                          <div class="modal-header">
                              <h5 class="modal-title">Delete account</h5>
                              <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body" id="modal-body">
                              ` + result + `
                          </div>
                          <div class="modal-footer">
                              <button type="button" class="btn btn-success" data-dismiss="modal">Close</button>
                          </div>`);
                      $("#generic-modal").on("hide.bs.modal",  () => window.location.href=redirectTo);
                  });
        });
     }
	</script>
  <div th:replace="fragments/general-message-modal"></div>
  <div th:replace="fragments/jwt-refresher :: jwt_refresher"></div>
</body>
</html>



